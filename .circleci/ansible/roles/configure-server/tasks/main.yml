---
- name: "Update apt-get using an equivalent command"
  apt:
   update_cache: yes

# - name: nvm
#   shell: >
#     curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
#   args:
#     creates: "{{ ansible_env.HOME }}/.nvm/nvm.sh"

- name: "Add Node.js from Nodesource"
  become: true
  shell: | 
    KEYRING=/usr/share/keyrings/nodesource.gpg
    curl -fsSL https://deb.nodesource.com/gpgkey/nodesource.gpg.key | gpg --dearmor | sudo tee "$KEYRING" >/dev/null 
    gpg --no-default-keyring --keyring "$KEYRING" --list-keys
    curl -fsSL https://deb.nodesource.com/setup_13.x | sudo -E bash -
    apt -y install nodejs
    apt install -y build-essential 
    
- name: "Install Node.js 13"
  become: true
  apt:
    name: ["nodejs"]
    state: latest
    update_cache: yes

- name: "Install PM2 Globally"
  npm:
    name: pm2
    global: yes

- name: "copy .env file to /etc/profile.d"
  become: true 
  copy:
    src: env.sh
    dest: /etc/profile.d/